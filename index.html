<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Galton Board</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            background-color: #f0f0f0;
        }
        #controls {
            margin: 20px;
            padding: 20px;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        label, input {
            margin: 10px;
        }
    </style>
</head>
<body>
    <h1>Interactive Galton Board</h1>
    <div id="controls">
        <label for="levels">Number of Levels:</label>
        <input type="number" id="levels" min="1" max="20" value="10">
        <label for="balls">Number of Balls:</label>
        <input type="number" id="balls" min="1" max="1000" value="500">
        <button onclick="restart()">Restart</button>
    </div>
    <div id="canvas-container"></div>

    <script>
        let levels, balls;
        let positions = [];
        let bins = [];
        let maxBinHeight = 0;

        function setup() {
            const canvas = createCanvas(800, 600);
            canvas.parent('canvas-container');
            restart();
        }

        function restart() {
            levels = parseInt(document.getElementById('levels').value);
            balls = parseInt(document.getElementById('balls').value);
            positions = [];
            bins = new Array(levels + 1).fill(0);
            maxBinHeight = 0;
            loop();
        }

        function draw() {
            background(240);
            
            // Draw pegs
            fill(100);
            for (let i = 0; i < levels; i++) {
                for (let j = 0; j <= i; j++) {
                    let x = map(j, 0, i, width/4, 3*width/4);
                    let y = map(i, 0, levels, 50, height - 150);
                    circle(x, y, 5);
                }
            }
            
            // Update ball positions
            if (positions.length < balls) {
                positions.push({x: width/2, y: 0, path: []});
            }
            
            for (let i = positions.length - 1; i >= 0; i--) {
                let ball = positions[i];
                if (ball.path.length < levels) {
                    ball.path.push(random() < 0.5 ? -1 : 1);
                }
                ball.x += ball.path[ball.path.length - 1] * width / (4 * levels);
                ball.y = map(ball.path.length, 0, levels, 0, height - 150);
                
                if (ball.path.length === levels) {
                    let binIndex = ball.path.filter(p => p === 1).length;
                    bins[binIndex]++;
                    if (bins[binIndex] > maxBinHeight) {
                        maxBinHeight = bins[binIndex];
                    }
                    positions.splice(i, 1);
                } else {
                    fill(255, 0, 0);
                    circle(ball.x, ball.y, 5);
                }
            }
            
            // Draw bins
            for (let i = 0; i <= levels; i++) {
                let x = map(i, 0, levels, width/4, 3*width/4);
                let h = map(bins[i], 0, maxBinHeight, 0, 100);
                fill(0, 255, 0);
                rect(x - 10, height - 50 - h, 20, h);
            }
            
            if (positions.length === 0 && frameCount > 10) {
                noLoop();
            }
        }
    </script>
</body>
</html>
